<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
    <title>éƒ½å¸‚ç¹æ˜ŸÂ·æ–°æ˜¥ç¥ç¦ï¼ˆçƒŸèŠ±é­ç‚®ç‰ˆï¼‰</title>
    <!-- æ·±è‰²æ¨¡å¼ï¼šåªè®¾ç½®èƒŒæ™¯è‰²ï¼Œå®Œå…¨ä¸æ”¹å˜ä½ åŸæ¥çš„è¾¹æ¡†å’Œæ ·å¼ -->
    <script>
        (function() {
            document.documentElement.style.backgroundColor = 'rgb(10 12 25 / var(--tw-bg-opacity))';
            document.body.style.backgroundColor = 'rgb(10 12 25 / var(--tw-bg-opacity))';
        })();
    </script>
    <style>
    /* ===== ç¯ç¬¼æ ¸å¿ƒæ ·å¼ ===== */
    .lantern-left,
    .lantern-right {
        position: fixed;
        top: 20%;
        transform: translateY(-50%);
        width: 90px;
        height: 120px;
        z-index: 2000;
        pointer-events: none;
        animation: float 4s infinite ease-in-out;
    }
    
    .lantern-left { left: 120px; }
    .lantern-right { right: 120px; }
    
    .lantern-body {
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 30% 30%, #e63946, #b71c1c);
        border-radius: 50% 50% 45% 45% / 55% 55% 45% 45%;
        border: 3px solid #ffb347;
        box-shadow: 0 0 20px rgba(255, 80, 80, 0.7), inset 0 -5px 15px rgba(0,0,0,0.4);
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        animation: sway 2.5s ease-in-out infinite;
        transform-origin: top center;
    }
    
    .lantern-body::before,
    .lantern-body::after {
        content: '';
        position: absolute;
        width: 90%;
        height: 8px;
        background: radial-gradient(circle, #ffd966, #d4a017);
        border-radius: 20px;
        left: 5%;
    }
    
    .lantern-body::before { top: 15%; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    .lantern-body::after { bottom: 15%; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    
    .lantern-text {
        font-size: 38px;
        font-weight: 900;
        color: #ffec9e;
        text-shadow: 2px 2px 0 #a52a2a, 4px 4px 8px #000;
        font-family: 'KaiTi', 'æ¥·ä½“', 'Microsoft YaHei', cursive;
        line-height: 1;
    }
    
    .lantern-handle {
        width: 20px;
        height: 24px;
        background: #8b5a2b;
        border-radius: 10px 10px 2px 2px;
        margin: 0 auto 4px;
        box-shadow: 0 2px 6px #3e2b1b;
        border-bottom: 2px solid #c07a3a;
    }
    
    .tassel {
        width: 48px;
        height: 32px;
        background: radial-gradient(ellipse at top, #c91414, #8b1a1a);
        margin: -8px auto 0;
        border-radius: 50% 50% 30% 30% / 60% 60% 30% 30%;
        box-shadow: inset 0 6px 6px rgba(0,0,0,0.2);
        display: flex;
        justify-content: center;
    }
    
    .tassel::after {
        content: 'ğŸ';
        font-size: 20px;
        color: #ffe066;
        line-height: 30px;
        text-shadow: 0 2px 2px black;
        transform: rotate(5deg);
    }
    
    .lantern-right .lantern-text { font-size: 36px; }
    .lantern-right .tassel { background: radial-gradient(ellipse at top, #b80c0c, #7a1515); }
    
    @keyframes sway {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(4deg); }
        50% { transform: rotate(0deg); }
        75% { transform: rotate(-4deg); }
        100% { transform: rotate(0deg); }
    }
    
    @keyframes float {
        0% { top: 45%; }
        50% { top: 47%; }
        100% { top: 45%; }
    }
    
    /* ===== ç¹æ˜Ÿç¯ç»• - æ•°é‡å·²å‡åŠ ===== */
    .lantern-stars {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1500;
    }
    
    /* æ˜Ÿæ˜ŸåŸºç¡€æ ·å¼ */
    .lantern-stars i {
        position: absolute;
        width: 8px;
        height: 8px;
        background: radial-gradient(circle at 30% 30%, #fffde7, #ffc107);
        border-radius: 50%;
        opacity: 0.9;
        animation: twinkle 3s infinite alternate;
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.9);
        pointer-events: auto;
        cursor: pointer;
        transition: all 0.2s ease;
        z-index: 1501;
    }
    
    /* ä¸åŒå¤§å°çš„æ˜Ÿæ˜Ÿ */
    .lantern-stars i.big-star {
        width: 12px;
        height: 12px;
        box-shadow: 0 0 15px rgba(255, 215, 0, 1);
        opacity: 1;
    }
    
    .lantern-stars i.small-star {
        width: 5px;
        height: 5px;
        opacity: 0.7;
    }
    
    /* æ‚¬åœæ”¾å¤§æ•ˆæœ */
    .lantern-stars i:hover {
        transform: scale(2.8);
        background: radial-gradient(circle at 30% 30%, #fff3b0, #ffb300);
        box-shadow: 0 0 25px rgba(255, 200, 0, 1);
        opacity: 1;
        z-index: 1800;
    }
    
    /* ===== ç¥ç¦è¯­æ°”æ³¡ - ç§»é™¤ç®­å¤´ ===== */
    .star-wish {
        visibility: hidden;
        opacity: 0;
        position: absolute;
        bottom: 32px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(145deg, #c62828, #b71c1c);
        color: #ffecb3;
        font-size: 15px;
        font-weight: 600;
        font-family: 'KaiTi', 'æ¥·ä½“', 'Microsoft YaHei', 'PingFang SC', sans-serif;
        white-space: nowrap;
        padding: 10px 22px;
        border-radius: 40px;
        box-shadow: 0 8px 16px rgba(0,0,0,0.4), 0 0 0 3px #ffb74d, 0 0 30px rgba(255, 200, 0, 0.4);
        text-shadow: 1px 1px 0 #5e0000;
        letter-spacing: 2px;
        border: 1px solid #ffe082;
        transition: opacity 0.2s, visibility 0.2s, bottom 0.2s;
        pointer-events: none;
        z-index: 10000 !important;
    }
    
    /* å®Œå…¨ç§»é™¤ç®­å¤´ */
    .star-wish::after {
        display: none;
    }
    
    .lantern-stars i:hover .star-wish {
        visibility: visible;
        opacity: 1;
        bottom: 45px;
        z-index: 10001 !important;
    }
    
    /* ç¯ç¬¼é™„è¿‘æ˜Ÿæ˜Ÿæ°”æ³¡ä½ç½®è°ƒæ•´ - ç§»é™¤ç®­å¤´ç›¸å…³æ ·å¼ */
    .lantern-stars i[style*="left: 6"] .star-wish,
    .lantern-stars i[style*="left: 7"] .star-wish,
    .lantern-stars i[style*="left: 8"] .star-wish,
    .lantern-stars i[style*="left: 9"] .star-wish,
    .lantern-stars i[style*="left: 10"] .star-wish,
    .lantern-stars i[style*="left: 11"] .star-wish,
    .lantern-stars i[style*="left: 12"] .star-wish,
    .lantern-stars i[style*="left: 13"] .star-wish,
    .lantern-stars i[style*="left: 14"] .star-wish,
    .lantern-stars i[style*="left: 15"] .star-wish,
    .lantern-stars i[style*="left: 16"] .star-wish,
    .lantern-stars i[style*="left: 17"] .star-wish,
    .lantern-stars i[style*="left: 18"] .star-wish,
    .lantern-stars i[style*="left: 19"] .star-wish {
        bottom: 65px !important;
        left: 80px !important;
        transform: none !important;
    }
    
    .lantern-stars i[style*="right: 6"] .star-wish,
    .lantern-stars i[style*="right: 7"] .star-wish,
    .lantern-stars i[style*="right: 8"] .star-wish,
    .lantern-stars i[style*="right: 9"] .star-wish,
    .lantern-stars i[style*="right: 10"] .star-wish,
    .lantern-stars i[style*="right: 11"] .star-wish,
    .lantern-stars i[style*="right: 12"] .star-wish,
    .lantern-stars i[style*="right: 13"] .star-wish,
    .lantern-stars i[style*="right: 14"] .star-wish,
    .lantern-stars i[style*="right: 15"] .star-wish,
    .lantern-stars i[style*="right: 16"] .star-wish,
    .lantern-stars i[style*="right: 17"] .star-wish,
    .lantern-stars i[style*="right: 18"] .star-wish,
    .lantern-stars i[style*="right: 19"] .star-wish,
    .lantern-stars i[style*="right: 20"] .star-wish {
        bottom: 65px !important;
        left: auto !important;
        right: 80px !important;
        transform: none !important;
    }
    
    .lantern-stars i.top-edge .star-wish {
        bottom: auto;
        top: 45px !important;
    }
    
    .lantern-stars i.left-edge .star-wish {
        left: 25px !important;
        transform: none;
    }
    
    .lantern-stars i.right-edge .star-wish {
        left: auto;
        right: 25px !important;
        transform: none;
    }
    
    @keyframes twinkle {
        0% { opacity: 0.5; transform: scale(0.9); box-shadow: 0 0 5px rgba(255, 215, 0, 0.6); }
        100% { opacity: 1; transform: scale(1.2); box-shadow: 0 0 15px rgba(255, 215, 0, 1); }
    }
    
    /* ===== å·¦ä¾§ç¯ç¬¼ä¸‹ç¥ç¦æŒ‰é’® ===== */
    .lantern-btn-container {
        position: fixed;
        left: 45%!important;
        top: 81%!important;
        transform: translateY(80px);
        z-index: 2500;
        pointer-events: auto;
    }
    
    .wish-btn {
        background: linear-gradient(145deg, #c62828, #b71c1c);
        color: #ffecb3;
        border: 2px solid #ffb74d;
        border-radius: 30px;
        padding: 5px 24px;
        font-size: 16px;
        font-weight: bold;
        font-family: 'KaiTi', 'æ¥·ä½“', 'Microsoft YaHei', sans-serif;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3), 0 0 0 2px #ffb347;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        white-space: nowrap;
    }
    
    .wish-btn:hover {
        transform: scale(1.05);
        background: linear-gradient(145deg, #d32f2f, #b71c1c);
        box-shadow: 0 6px 16px rgba(0,0,0,0.4), 0 0 0 3px #ffa000;
    }
    
    /* ===== å¼¹çª—è¡¨å•æ ·å¼ï¼ˆå®Œå…¨ä¿ç•™ä½ åŸæ¥çš„ï¼‰===== */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.7);
        z-index: 20000;
        display: none;
        justify-content: center;
        align-items: center;
    }
    
    .modal-content {
        background: linear-gradient(145deg, #fff3e0, #ffebcc);
        border-radius: 24px;
        padding: 32px 40px;
        width: 460px;
        max-width: 90%;
        box-shadow: 0 20px 40px rgba(0,0,0,0.4), 0 0 0 6px #ffb347;
        border: 2px solid #ffe082;
        position: relative;
    }
    
    .modal-content h3 {
        color: #b71c1c;
        font-size: 28px;
        margin: 0 0 24px 0;
        text-align: center;
        font-family: 'KaiTi', 'æ¥·ä½“', sans-serif;
        text-shadow: 1px 1px 0 #ffe082;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        color: #8b3a3a;
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 8px;
        font-family: 'KaiTi', 'æ¥·ä½“', sans-serif;
    }
    
    /* è‡ªå®šä¹‰ä¸‹æ‹‰æ¡† */
    .custom-select {
        position: relative;
        width: 100%;
    }
    
    .select-selected {
        background: white;
        border: 2px solid #ffb347;
        border-radius: 30px;
        padding: 12px 16px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: black;
        font-size: 16px;
        font-family: 'Microsoft YaHei', sans-serif;
        transition: all 0.2s;
    }
    
    .select-selected:hover {
        border-color: #c62828;
        box-shadow: 0 0 0 2px rgba(198, 40, 40, 0.1);
    }
    
    .select-items {
        position: absolute;
        top: 110%;
        left: 0;
        right: 0;
        background: white;
        border: 2px solid #ffb347;
        border-radius: 20px;
        z-index: 9999;
        max-height: 300px;
        overflow-y: auto;
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .select-items div {
        padding: 12px 16px;
        cursor: pointer;
        color: black;
        font-size: 16px;
        font-family: 'Microsoft YaHei', sans-serif;
        transition: all 0.2s;
    }
    
    .select-items div:first-child {
        border-top-left-radius: 18px;
        border-top-right-radius: 18px;
    }
    
    .select-items div:last-child {
        border-bottom-left-radius: 18px;
        border-bottom-right-radius: 18px;
    }
    
    .select-items div:hover {
        background: #ffb347;
        color: #b71c1c;
    }
    
    .select-items div.selected-item {
        background: #b71c1c;
        color: #ffecb3 !important;
    }
    
    .select-arrow {
        color: #b71c1c;
        font-size: 14px;
        transition: transform 0.2s;
    }
    
    .form-group input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #ffb347;
        border-radius: 30px;
        font-size: 16px;
        color: #000;
        background: white;
        font-family: 'Microsoft YaHei', sans-serif;
        box-sizing: border-box;
    }
    
    .form-group input:focus {
        outline: none;
        border-color: #c62828;
        box-shadow: 0 0 0 3px rgba(198, 40, 40, 0.2);
    }
    
    #recipient {
        display: none;
    }
    
    .modal-buttons {
        display: flex;
        gap: 16px;
        margin-top: 32px;
        justify-content: center;
    }
    
    .submit-btn, .cancel-btn {
        padding: 12px 32px;
        border: none;
        border-radius: 40px;
        font-size: 18px;
        font-weight: bold;
        font-family: 'KaiTi', 'æ¥·ä½“', sans-serif;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
    }
    
    .submit-btn {
        background: linear-gradient(145deg, #c62828, #b71c1c);
        color: #ffecb3;
    }
    
    .cancel-btn {
        background: #9e9e9e;
        color: white;
    }
    
    .submit-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 0 15px rgba(198, 40, 40, 0.5);
        border-color: #ffb74d;
    }
    
    .cancel-btn:hover {
        background: #757575;
        transform: scale(1.05);
    }
    
    /* ===== æ»šåŠ¨ç¥ç¦å¢™ ===== */
    .wish-wall {
        top: 40px!important;
        left: 300px;
        right: 300px;
        height: 40px;
        margin-bottom:20px;
        background: linear-gradient(145deg, #c62828, #b71c1c);
        margin-top:10px!important;
        backdrop-filter: blur(5px);
        border-radius: 50px;
        border: 3px solid #ffb347;
        z-index: 3000;
        overflow: hidden;
        display: flex;
        align-items: center;
    }
    
    .wish-scroll {
        display: flex;
        animation: scrollWishes 40s linear infinite;
        white-space: nowrap;
        gap: 20px;
    }
    
    .wish-item {
        color: #ffecb3;
        font-size: 18px;
        font-family: 'KaiTi', 'æ¥·ä½“', 'Microsoft YaHei', sans-serif;
        text-shadow: 1px 1px 0 #5e0000;
        display: flex;
        align-items: center;
        gap: 8px;
        border-radius: 30px;
        height: 50px;
    }
    
    .wish-item span {
        font-weight: bold;
        color: #ffd966;
    }
    
    @keyframes scrollWishes {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }
    
    .wish-wall:hover .wish-scroll {
        animation-play-state: paused;
    }
    
    @media (max-width: 1000px) {
        .wish-wall {
            left: 20px;
            right: 20px;
        }
    }
    
    @media (max-width: 700px) {
        .lantern-left, .lantern-right { width: 70px; height: 94px; }
        .lantern-left { left: 6px; }
        .lantern-right { right: 6px; }
        .lantern-text { font-size: 28px; }
        .lantern-stars i { width: 6px; height: 6px; }
        .lantern-stars i.big-star { width: 9px; height: 9px; }
        .lantern-stars i.small-star { width: 4px; height: 4px; }
        .star-wish {
            font-size: 12px;
            padding: 6px 16px;
            bottom: 25px;
            white-space: nowrap;
        }
        .lantern-btn-container { left: 6px; }
        .wish-btn { padding: 8px 16px; font-size: 14px; }
        .wish-wall { left: 10px; right: 10px; height: 60px; }
        .wish-item { font-size: 14px; height: 40px; }
        .modal-content { padding: 24px 20px; }
        .modal-content h3 { font-size: 24px; }
    }

    /* ===== çƒŸèŠ±ç‰¹æ•ˆCanvas ===== */
    .firework-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 99999;
    }

    /* ===== é­ç‚®æ•ˆæœæ ·å¼ ===== */
    .firecracker-container {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 100000;
        pointer-events: none;
    }
    
    .firecracker {
        position: relative;
        width: 60px;
        height: 80px;
        cursor: pointer;
        pointer-events: auto;
        filter: drop-shadow(0 0 10px rgba(255, 0, 0, 0.5));
        animation: swing 2s ease-in-out infinite;
        transform-origin: top center;
    }
    
    .firecracker-body {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 70px;
        background: linear-gradient(145deg, #e31b23, #b71c1c);
        border-radius: 10px 10px 20px 20px;
        border: 2px solid #ffb74d;
        box-shadow: 0 4px 0 #7a1515, 0 8px 12px rgba(0,0,0,0.4);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 32px;
        color: #ffe066;
        text-shadow: 0 0 10px #ffaa00;
    }
    
    .firecracker-fuse {
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        width: 4px;
        height: 25px;
        background: linear-gradient(to right, #8b5a2b, #5d3a1b);
        border-radius: 2px;
    }
    
    .firecracker-fuse::after {
        content: '';
        position: absolute;
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 12px;
        height: 12px;
        background: radial-gradient(circle, #ffd700, #ff8c00);
        border-radius: 50%;
        box-shadow: 0 0 15px #ffaa00;
        animation: spark 0.5s ease-in-out infinite alternate;
    }
    
    @keyframes swing {
        0%, 100% { transform: rotate(-3deg); }
        50% { transform: rotate(3deg); }
    }
    
    @keyframes spark {
        0% { opacity: 0.8; transform: translateX(-50%) scale(0.8); }
        100% { opacity: 1; transform: translateX(-50%) scale(1.2); }
    }
    
    .firecracker:hover {
        animation: shake 0.5s ease-in-out;
    }
    
    @keyframes shake {
        0%, 100% { transform: rotate(-3deg); }
        25% { transform: rotate(10deg); }
        75% { transform: rotate(-10deg); }
    }
    
    /* ===== é­ç‚®çˆ†ç‚¸ç²’å­ ===== */
    .cracker-particle {
        position: fixed;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        pointer-events: none;
        z-index: 100001;
        box-shadow: 0 0 15px currentColor;
        animation: crackerExplode 1s ease-out forwards;
    }
    
    @keyframes crackerExplode {
        0% { transform: scale(1); opacity: 1; }
        100% { transform: scale(0.2); opacity: 0; }
    }

    /* ===== è‡ªåŠ¨æ’­æ”¾æç¤º ===== */
    .auto-play-hint {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(0,0,0,0.7);
        color: #ffecb3;
        padding: 10px 20px;
        border-radius: 30px;
        border: 2px solid #ffb347;
        font-family: 'KaiTi', sans-serif;
        font-size: 16px;
        z-index: 100002;
        pointer-events: none;
        backdrop-filter: blur(5px);
        box-shadow: 0 0 20px rgba(255, 180, 70, 0.5);
        animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 0.8; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.05); }
    }

    /* ===== é™éŸ³æŒ‰é’® ===== */
    .mute-btn {
        position: fixed;
        bottom: 20px;
        right: 220px;
        background: rgba(0,0,0,0.7);
        color: #ffecb3;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 2px solid #ffb347;
        font-size: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 100003;
        backdrop-filter: blur(5px);
        box-shadow: 0 0 20px rgba(255, 180, 70, 0.5);
        transition: all 0.3s;
    }
    
    .mute-btn:hover {
        transform: scale(1.1);
        background: rgba(0,0,0,0.9);
        border-color: #ffb74d;
    }

    /* ===== éŸ³é¢‘æ¿€æ´»æç¤º ===== */
    .audio-hint {
        position: fixed;
        bottom: 20px;
        left: 100px;
        background: rgba(0,0,0,0.7);
        color: #ffecb3;
        padding: 8px 16px;
        border-radius: 30px;
        border: 2px solid #ffb347;
        font-family: 'KaiTi', sans-serif;
        font-size: 14px;
        z-index: 100004;
        pointer-events: none;
        backdrop-filter: blur(5px);
        animation: fadeInOut 3s ease-in-out;
    }
    
    @keyframes fadeInOut {
        0% { opacity: 0; transform: translateY(10px); }
        20% { opacity: 1; transform: translateY(0); }
        80% { opacity: 1; transform: translateY(0); }
        100% { opacity: 0; transform: translateY(-10px); }
    }
    </style>
</head>
<body>
    <!-- ç¹æ˜Ÿç¯ç»•ç¯ç¬¼ - æ•°é‡å·²å‡åŠï¼Œå…±79é¢—æ˜Ÿæ˜Ÿï¼Œæ¯æ¡ç¥ç¦è¯­ä¸é‡å¤ -->
    <div class="lantern-stars" id="starContainer">
        <!-- ===== å·¦ä¾§åŒºåŸŸç¹æ˜Ÿ ===== -->
        <i class="big-star" style="left: 15px; top: 3%;"></i>
        <i style="left: 62px; top: 7%;"></i>
        <i class="small-star" style="left: 115px; top: 5%;"></i>
        <i style="left: 35px; top: 11%;"></i>
        <i class="small-star" style="left: 143px; top: 9%;"></i>
        <i style="left: 185px; top: 13%;"></i>
        <i class="big-star" style="left: 215px; top: 6%;"></i>
        <i style="left: 245px; top: 10%;"></i>
        <i class="small-star" style="left: 155px; top: 15%;"></i>
        <i style="left: 95px; top: 18%;"></i>
        <i class="small-star" style="left: 38px; top: 20%;"></i>
        <i style="left: 235px; top: 22%;"></i>
        <i class="big-star" style="left: 70px; top: 25%;"></i>
        <i style="left: 50px; top: 33%;"></i>
        <i class="big-star" style="left: 150px; top: 35%;"></i>
        <i class="small-star" style="left: 210px; top: 38%;"></i>
        <i style="left: 30px; top: 40%;"></i>
        <i class="small-star" style="left: 230px; top: 42%;"></i>
        <i style="left: 90px; top: 45%;"></i>
        <i class="big-star" style="left: 160px; top: 48%;"></i>
        <i style="left: 10px; top: 50%;"></i>
        <i class="small-star" style="left: 123px; top: 52%;"></i>
        <i class="small-star" style="left: 40px; top: 70%;"></i>
        <i style="left: 130px; top: 72%;"></i>
        <i class="big-star" style="left: 190px; top: 75%;"></i>
        <i style="left: 60px; top: 78%;"></i>
        <i class="small-star" style="left: 150px; top: 80%;"></i>
        <i style="left: 210px; top: 82%;"></i>
        <i class="small-star" style="left: 18px; top: 85%;"></i>
        <i style="left: 103px; top: 88%;"></i>
        
        <!-- ===== å³ä¾§åŒºåŸŸç¹æ˜Ÿ ===== -->
        <i class="big-star" style="right: 25px; top: 3%;"></i>
        <i style="right: 82px; top: 7%;"></i>
        <i class="small-star" style="right: 150px; top: 5%;"></i>
        <i style="right: 45px; top: 11%;"></i>
        <i class="small-star" style="right: 178px; top: 9%;"></i>
        <i style="right: 220px; top: 13%;"></i>
        <i class="big-star" style="right: 250px; top: 6%;"></i>
        <i style="right: 280px; top: 10%;"></i>
        <i class="small-star" style="right: 190px; top: 15%;"></i>
        <i style="right: 130px; top: 18%;"></i>
        <i class="small-star" style="right: 58px; top: 20%;"></i>
        <i style="right: 270px; top: 22%;"></i>
        <i class="big-star" style="right: 95px; top: 25%;"></i>
        <i style="right: 75px; top: 33%;"></i>
        <i class="big-star" style="right: 185px; top: 35%;"></i>
        <i class="small-star" style="right: 245px; top: 38%;"></i>
        <i style="right: 55px; top: 40%;"></i>
        <i class="small-star" style="right: 265px; top: 42%;"></i>
        <i style="right: 125px; top: 45%;"></i>
        <i class="big-star" style="right: 195px; top: 48%;"></i>
        <i style="right: 28px; top: 50%;"></i>
        <i class="small-star" style="right: 158px; top: 52%;"></i>
        <i class="small-star" style="right: 65px; top: 70%;"></i>
        <i style="right: 165px; top: 72%;"></i>
        <i class="big-star" style="right: 225px; top: 75%;"></i>
        <i style="right: 85px; top: 78%;"></i>
        <i class="small-star" style="right: 185px; top: 80%;"></i>
        <i style="right: 245px; top: 82%;"></i>
        <i class="small-star" style="right: 38px; top: 85%;"></i>
        <i style="right: 138px; top: 88%;"></i>
        
        <!-- ===== ä¸­é—´æ˜Ÿæ¡¥åŒºåŸŸ ===== -->
        <i style="left: 260px; top: 8%;"></i>
        <i class="small-star" style="left: 280px; top: 18%;"></i>
        <i style="left: 300px; top: 28%;"></i>
        <i class="big-star" style="left: 260px; top: 38%;"></i>
        <i style="left: 280px; top: 48%;"></i>
        <i class="small-star" style="left: 300px; top: 58%;"></i>
        <i style="right: 290px; top: 12%;"></i>
        <i class="small-star" style="right: 310px; top: 22%;"></i>
        <i style="right: 330px; top: 32%;"></i>
        <i class="big-star" style="right: 290px; top: 42%;"></i>
        <i style="right: 310px; top: 52%;"></i>
        <i class="small-star" style="right: 330px; top: 62%;"></i>
        
        <!-- ===== ä¸Šä¸‹åŒºåŸŸåŠç‚¹ç¼€ ===== -->
        <i class="big-star" style="left: 30px; top: 5px;"></i>
        <i style="left: 80px; top: 12px;"></i>
        <i class="small-star" style="left: 130px; top: 8px;"></i>
        <i class="big-star" style="right: 45px; top: 5px;"></i>
        <i style="right: 95px; top: 12px;"></i>
        <i class="small-star" style="right: 145px; top: 8px;"></i>
        <i class="big-star" style="left: 20px; bottom: 5px;"></i>
        <i style="left: 70px; bottom: 12px;"></i>
        <i class="small-star" style="left: 120px; bottom: 8px;"></i>
        <i class="big-star" style="right: 35px; bottom: 5px;"></i>
        <i style="right: 85px; bottom: 12px;"></i>
        <i class="small-star" style="right: 135px; bottom: 8px;"></i>
        <i class="big-star" style="left: 70px; top: 1%;"></i>
        <i style="left: 125px; top: 2%;"></i>
        <i class="big-star" style="right: 85px; top: 1%;"></i>
        <i style="right: 140px; top: 2%;"></i>
    </div>
    
    <!-- å·¦å³ç¯ç¬¼ -->
    <div class="lantern-left">
        <div class="lantern-handle"></div>
        <div class="lantern-body">
            <div class="lantern-text">æ˜¥</div>
        </div>
        <div class="tassel"></div>
    </div>
    
    <div class="lantern-right">
        <div class="lantern-handle"></div>
        <div class="lantern-body">
            <div class="lantern-text">ç¦</div>
        </div>
        <div class="tassel"></div>
    </div>
    
    <!-- å·¦ä¾§ç¯ç¬¼ä¸‹ç¥ç¦æŒ‰é’® -->
    <div class="lantern-btn-container">
        <button class="wish-btn" onclick="openWishModal()">
            <span style="font-size: 24px;">ğŸ‰</span> å†™æ–°å¹´ç¥ç¦
        </button>
    </div>
    
    <!-- ç¥ç¦å¼¹çª— -->
    <div id="wishModal" class="modal-overlay">
        <div class="modal-content">
            <h3>âœ¨ å†™æ–°å¹´ç¥ç¦ âœ¨</h3>
            <div class="form-group">
                <label>ğŸ“ æ˜µç§°</label>
                <input type="text" id="nickname" placeholder="ä½ çš„åå­—æˆ–æ˜µç§°" maxlength="20">
            </div>
            <div class="form-group">
                <label>ğŸ¯ ç¥ç¦è°</label>
                <div class="custom-select">
                    <div class="select-selected" onclick="toggleDropdown(event)">
                        <span id="selectedOption">åšä¸»</span>
                        <span class="select-arrow">â–¼</span>
                    </div>
                    <div id="selectOptions" class="select-items" style="display: none;">
                        <div onclick="selectOption('åšä¸»')" class="selected-item">åšä¸»</div>
                        <div onclick="selectOption('è‡ªå·±')">è‡ªå·±</div>
                        <div onclick="selectOption('å¤§å®¶')">å¤§å®¶</div>
                        <div onclick="selectOption('å¥½å‹')">å¥½å‹</div>
                        <div onclick="selectOption('ä¼´ä¾£')">ä¼´ä¾£</div>
                        <div onclick="selectOption('å­©å­')">å­©å­</div>
                        <div onclick="selectOption('çˆ¶æ¯')">çˆ¶æ¯</div>
                    </div>
                </div>
                <select id="recipient" style="display: none;">
                    <option value="åšä¸»" selected>åšä¸»</option>
                    <option value="è‡ªå·±">è‡ªå·±</option>
                    <option value="å¤§å®¶">å¤§å®¶</option>
                    <option value="å¥½å‹">å¥½å‹</option>
                    <option value="ä¼´ä¾£">ä¼´ä¾£</option>
                    <option value="å­©å­">å­©å­</option>
                    <option value="çˆ¶æ¯">çˆ¶æ¯</option>
                </select>
            </div>
            <div class="form-group">
                <label>ğŸ’ ç¥ç¦å†…å®¹</label>
                <input type="text" id="wishContent" placeholder="è¾“å…¥ä½ çš„ç¥ç¦è¯­..." maxlength="50">
            </div>
            <div class="modal-buttons">
                <button class="submit-btn" onclick="submitWish()">âœ¨ æäº¤ç¥ç¦ âœ¨</button>
                <button class="cancel-btn" onclick="closeWishModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- æ»šåŠ¨ç¥ç¦å¢™ -->
    <div class="wish-wall">
        <div class="wish-scroll" id="wishScroll"></div>
    </div>

    <!-- ===== ğŸ† é­ç‚®å…ƒç´  ===== -->
    <div class="firecracker-container">
        <div class="firecracker" id="firecracker">
            <div class="firecracker-fuse"></div>
            <div class="firecracker-body">
                ğŸ§¨
            </div>
        </div>
    </div>

    <!-- ===== ğŸ”‡ é™éŸ³æ§åˆ¶æŒ‰é’® ===== -->
    <div class="mute-btn" id="muteBtn">ğŸ”Š</div>
    
    <!-- ===== ğŸ† è‡ªåŠ¨æ’­æ”¾æç¤º ===== -->
    <div class="auto-play-hint" id="autoPlayHint">
        ğŸ† æ–°æ˜¥çƒŸèŠ±è‡ªåŠ¨æ’­æ”¾ä¸­
    </div>

    <!-- ===== ğŸ† çƒŸèŠ±ç‰¹æ•ˆCanvas ===== -->
    <canvas id="fireworkCanvas" class="firework-canvas"></canvas>
    
    <script>
    // ===== éƒ½å¸‚ä¸“å±ç¥ç¦è¯­åº“ï¼ˆ84æ¡ï¼‰=====
    (function() {
        'use strict';
        
        const urbanWishes = [
            "ğŸ’» å·¥ä½œé¡ºå¿ƒï¼Œé¡¹ç›®é¡ºåˆ©", "ğŸ‹ï¸ èº«ä½“å¥åº·ï¼Œå……æ»¡æ´»åŠ›", "ğŸ“ˆ è´¢æºå¹¿è¿›ï¼Œæ”¶ç›Šé•¿çº¢",
            "ğŸ  å®‰å±…ä¹ä¸šï¼Œå®¶å®…å¹³å®‰", "ğŸš— å‡ºè¡Œå¹³å®‰ï¼Œä¸€è·¯é¡ºé£", "ğŸ‘¶ å­©å­å¥åº·ï¼Œå¿«ä¹æˆé•¿",
            "ğŸ’‘ æ„Ÿæƒ…ç”œèœœï¼Œç›¸å®ˆç›¸ä¼´", "ğŸ± å® ç‰©æ´»æ³¼ï¼Œé™ªä¼´æš–å¿ƒ", "ğŸ“± äº‹ä¸šæœ‰æˆï¼Œè’¸è’¸æ—¥ä¸Š",
            "ğŸ§³ æ—…é€”æ„‰å¿«ï¼Œé£æ™¯å¸¸æ–°", "ğŸ’† å®¹å…‰ç„•å‘ï¼Œç²¾åŠ›å……æ²›", "ğŸ“ å­¦ä¸šè¿›æ­¥ï¼Œå‰ç¨‹ä¼¼é”¦",
            "ğŸ³ ç”Ÿæ´»æœ‰å‘³ï¼Œæ—¥æ—¥ä¸‰é¤", "ğŸ›‹ï¸ å±…æ‰€æ¸©é¦¨ï¼Œå²æœˆé™å¥½", "ğŸ‘Ÿ æ­¥å±¥è½»ç›ˆï¼Œè‡ªåœ¨å¦‚é£",
            "ğŸ’ è‰¯ç¼˜ç¾æ»¡ï¼Œæºæ‰‹ä¸€ç”Ÿ", "ğŸ‘ª å®¶äººå®‰åº·ï¼Œå›¢åœ†å¸¸ä¹", "ğŸ¤ è´µäººç›¸åŠ©ï¼ŒçŸ¥å·±ç›¸ä¼´",
            "ğŸ¸ å…´è¶£æˆè¶£ï¼Œå¿ƒç”Ÿæ¬¢å–œ", "ğŸ“· è®°å½•ç¾å¥½ï¼Œå›å¿†ç”Ÿå…‰", "ğŸƒ å¿ƒæ— æŒ‚ç¢ï¼Œå¤œå¤œå¥½çœ ",
            "ğŸ§˜ èº«å¿ƒèˆ’å±•ï¼Œå¹³è¡¡è‡ªåœ¨", "ğŸ· å°é…Œæ€¡æƒ…ï¼Œæ¸…é†’ä»å®¹", "ğŸ‘” èŒåœºé¡ºé‚ï¼Œæ­¥æ­¥é«˜å‡",
            "ğŸ¡ å®¶å’Œäººå…´ï¼Œå²æœˆæ¸©æŸ”", "ğŸ¶ èŒå® ç›¸ä¼´ï¼Œæ—¥æ—¥æ²»æ„ˆ", "ğŸ–¥ï¸ å·¥ä½œé«˜æ•ˆï¼Œå¾—å¿ƒåº”æ‰‹",
            "ğŸ“Š ææ¡ˆé€šè¿‡ï¼Œæ‰åè¢«è§", "ğŸ¤ è‡ªä¿¡å‘å…‰ï¼Œé—ªè€€æ—¶åˆ»", "ğŸ§¹ ç”Ÿæ´»æœ‰åºï¼Œå†…å¿ƒæ¾„æ˜",
            "ğŸš´ ä¹˜é£è€Œè¡Œï¼Œè‡ªç”±ç•…å¿«", "ğŸ® å¼ å¼›æœ‰åº¦ï¼Œä¹åœ¨å…¶ä¸­", "ğŸ›µ æ—¥å¸¸é€šå‹¤ï¼Œå¹³å®‰é¡ºé‚",
            "ğŸŒ¿ é˜³å°æœ‰ç»¿ï¼Œå¿ƒç”Ÿæ¬¢å–œ", "ğŸ“š å¼€å·æœ‰ç›Šï¼Œæ€æƒ³ä¸°ç›ˆ", "âœï¸ ç¬”ä¸‹æœ‰å…‰ï¼Œåˆ›ä½œè‡ªç”±",
            "ğŸ¬ å¥½æˆè¿å°ï¼Œç”Ÿæ´»æœ‰è¶£", "ğŸ² äººé—´çƒŸç«ï¼Œæ¸©æš–å¸¸åœ¨", "ğŸ§§ è´¢æ°”ç›ˆé—¨ï¼Œå¥½è¿è¿è¿",
            "ğŸ›’ ç‰©æœ‰æ‰€çˆ±ï¼Œè´­æœ‰æ‰€ä¹", "ğŸ’ æ—§ç‰©æ–°ç”Ÿï¼Œå°æœ‰æ”¶è·", "ğŸŸï¸ å¦‚æ„¿ä»¥å¿ï¼Œå¿ƒæƒ³äº‹æˆ",
            "ğŸ§¶ å·§æ‰‹åŒ å¿ƒï¼Œæ¸©æš–è¿‡å†¬", "ğŸ•¯ï¸ ä¸€å®¤æ¸…é¦™ï¼Œå¿ƒå®‰å³å½’", "ğŸµ èŒ¶æš–äººå¿ƒï¼Œæ—¥æ—¥æ˜¯å¥½æ—¥",
            "â˜• æ™¨èµ·æœ‰å…‰ï¼Œå’–å•¡é£˜é¦™", "ğŸ± å·¥ä½œå†å¿™ï¼Œå¥½å¥½åƒé¥­", "ğŸ‡ å¥åº·é¥®é£Ÿï¼Œè½»ç›ˆä½“æ€",
            "ğŸ©° ä¼˜é›…ä»å®¹ï¼Œæ°”è´¨å¦‚å…°", "ğŸ„ å‹‡æ•¢å°è¯•ï¼Œæ‹¥æŠ±æ–°è¶£", "â›·ï¸ å¥”èµ´å±±æµ·ï¼Œè‡ªåœ¨å¦‚é£",
            "ğŸ¥ æŒ¥æ´’æ±—æ°´ï¼Œå¿«ä¹è¿åŠ¨", "ğŸ§— æŒ‘æˆ˜è‡ªæˆ‘ï¼Œæ­¥æ­¥å‘ä¸Š", "ğŸ¾ æŒ¥æ‹ä¹‹é—´ï¼Œé‡Šæ”¾å‹åŠ›",
            "ğŸ¸ é…£ç•…æ·‹æ¼“ï¼Œèº«å¿ƒèˆ’ç•…", "ğŸ¥Š æœ‰åŠ›ä¹Ÿæœ‰åº¦ï¼Œå¼ å¼›ä»å®¹", "ğŸ§˜â€â™€ï¸ å¿ƒé™å¦‚æ°´ï¼Œå†…è€—å½’é›¶",
            "ğŸ› å¸ä¸‹ç–²æƒ«ï¼Œæ‹¥æŠ±æ¾å¼›", "ğŸ§– å®¹å…‰ç„•å‘ï¼Œè‡ªä¿¡ä»å®¹", "ğŸ’‡ ç„•ç„¶ä¸€æ–°ï¼Œæ‚¦çº³è‡ªå·±",
            "ğŸ‘— ç©¿å‡ºè‡ªæˆ‘ï¼Œè‡ªåœ¨å¾—ä½“", "ğŸ•¶ï¸ é˜³å…‰æ­£å¥½ï¼Œå¿ƒæƒ…æ˜åªš", "ğŸ‘  æ­¥å±¥ç”Ÿé£ï¼Œä¼˜é›…å‰è¡Œ",
            "ğŸ‘œ å¿ƒä»ªå·²ä¹…ï¼Œç»ˆå¾—æ‰€çˆ±", "âŒš è§„å¾‹ä½œæ¯ï¼Œæ—¥æ—¥ç²¾è¿›", "ğŸ’ æ—¶å…‰æ²‰æ·€ï¼Œæ„ˆå‘æ¸©æ¶¦",
            "ğŸŒ† æ™šéœæ¸©æŸ”ï¼Œäººé—´å€¼å¾—", "ğŸ™ï¸ åŸå¸‚ç¯ç«ï¼Œå¿ƒå®‰å½’å¤„", "ğŸŒ‰ å¤œè‰²å®œäººï¼Œæœ‰äººå…±èµ",
            "ğŸ¨ çœ¼ä¸­æœ‰ç¾ï¼Œå¿ƒä¸­æœ‰å…‰", "ğŸ­ æ²‰æµ¸å…¶ä¸­ï¼Œæ„ŸåŠ¨å¸¸åœ¨", "ğŸª å¼€æ€€ä¸€ç¬‘ï¼Œçƒ¦æ¼å…¨æ¶ˆ",
            "ğŸ¸ å¾®é†ºæ—¶åˆ»ï¼Œè‡ªåœ¨éšå¿ƒ", "ğŸ° ç”œåº¦åˆšå¥½ï¼Œç”Ÿæ´»å¦‚èœœ", "ğŸ§ å¤æ—¥æ¸…å‡‰ï¼Œç«¥å¿ƒæœªæ³¯",
            "ğŸ‚ å››æ—¶æµè½¬ï¼Œå„æœ‰é£æ™¯", "â„ï¸ å†¬æ—¥æš–é˜³ï¼Œæœ‰äººé—®æš–", "ğŸŒ¸ æ˜¥æœ‰çº¦ï¼ŒèŠ±ä¸è¯¯",
            "â˜€ï¸ æ—¥æ—¥æ˜¯å¥½æ—¥ï¼Œæ™¨èµ·æœ‰å…‰", "ğŸŒ§ï¸ é›¨æ‰“çª—æ£‚ï¼Œå¿ƒå®‰æ˜¯å®¶", "ğŸŒªï¸ é£é›¨æœ‰ä¼ï¼Œå½’é€”æœ‰ç¯",
            "ğŸš‡ äººæ¥äººå¾€ï¼Œç»ˆæœ‰å½’å¤„",
            "ğŸµ éŸ³ä¹ç›¸ä¼´ï¼Œå¿ƒæƒ…æ„‰æ‚¦", "ğŸ“– è¯»ä¹¦ä¸‡å·ï¼Œä¸‹ç¬”æœ‰ç¥", "ğŸ¨ çµæ„Ÿè¿¸å‘ï¼Œåˆ›ä½œä¸°æ”¶",
            "ğŸ† ç›®æ ‡è¾¾æˆï¼Œæ¢¦æƒ³æˆçœŸ", "ğŸŒˆ ç”Ÿæ´»å¤šå½©ï¼Œå¤©å¤©å¼€å¿ƒ"
        ];
        
        const stars = document.querySelectorAll('.lantern-stars i');
        
        stars.forEach((star, index) => {
            const wishSpan = document.createElement('span');
            wishSpan.className = 'star-wish';
            const wishIndex = index % urbanWishes.length;
            wishSpan.textContent = urbanWishes[wishIndex] + " âœ¨";
            star.appendChild(wishSpan);
            star.setAttribute('data-wish', wishSpan.textContent);
        });
        
        function adjustBubblePosition() {
            const viewportWidth = window.innerWidth;
            stars.forEach((star) => {
                star.classList.remove('top-edge', 'left-edge', 'right-edge');
                const rect = star.getBoundingClientRect();
                const starTop = rect.top;
                const starLeft = rect.left;
                const starRight = viewportWidth - rect.right;
                
                if (starTop < 80) star.classList.add('top-edge');
                if (starLeft < 80) star.classList.add('left-edge');
                if (starRight < 80) star.classList.add('right-edge');
            });
        }
        
        adjustBubblePosition();
        window.addEventListener('resize', adjustBubblePosition);
        window.addEventListener('scroll', adjustBubblePosition, { passive: true });
        setTimeout(adjustBubblePosition, 200);
    })();
    
    // ===== è‡ªå®šä¹‰ä¸‹æ‹‰æ¡†ç›¸å…³å‡½æ•° =====
    window.toggleDropdown = function(event) {
        event.stopPropagation();
        var options = document.getElementById('selectOptions');
        var arrow = document.querySelector('.select-arrow');
        
        if (options.style.display === 'none') {
            options.style.display = 'block';
            if (arrow) arrow.innerHTML = 'â–²';
        } else {
            options.style.display = 'none';
            if (arrow) arrow.innerHTML = 'â–¼';
        }
    };
    
    window.selectOption = function(value) {
        document.getElementById('selectedOption').textContent = value;
        
        var select = document.getElementById('recipient');
        for (var i = 0; i < select.options.length; i++) {
            if (select.options[i].value === value) {
                select.options[i].selected = true;
                break;
            }
        }
        
        var allOptions = document.querySelectorAll('#selectOptions div');
        allOptions.forEach(function(opt) {
            opt.classList.remove('selected-item');
            if (opt.textContent === value) {
                opt.classList.add('selected-item');
            }
        });
        
        var options = document.getElementById('selectOptions');
        var arrow = document.querySelector('.select-arrow');
        options.style.display = 'none';
        if (arrow) arrow.innerHTML = 'â–¼';
    };
    
    document.addEventListener('click', function(event) {
        if (!event.target.closest('.custom-select')) {
            var options = document.getElementById('selectOptions');
            var arrow = document.querySelector('.select-arrow');
            if (options) {
                options.style.display = 'none';
                if (arrow) arrow.innerHTML = 'â–¼';
            }
        }
    });
    
    // ===== ğŸ¯ JSONå­˜å‚¨æ–¹æ¡ˆ Â· å…¨çƒå¯è§ç¥ç¦å¢™ =====
    const API_URL = window.location.protocol + '//' + window.location.host + '/usr/themes/sagrre/assets/wish-api.php';
    
    const WishAPI = {
        async saveWish(nickname, recipient, content) {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ nickname, recipient, content })
            });
            return await response.json();
        },
        async loadWishes() {
            try {
                const response = await fetch(API_URL);
                const wishes = await response.json();
                return Array.isArray(wishes) ? wishes : [];
            } catch (error) {
                console.error('åŠ è½½ç¥ç¦å¤±è´¥:', error);
                return [];
            }
        }
    };
    
    async function renderWishes() {
        const wishScroll = document.getElementById('wishScroll');
        if (!wishScroll) return;
        let wishes = await WishAPI.loadWishes();
        if (wishes.length === 0) {
            wishes = [{ nickname: 'ç³»ç»Ÿ', recipient: 'å¤§å®¶', content: 'å†™ä¸‹ç¬¬ä¸€æ¡ç¥ç¦å§ âœ¨' }];
        }
        const html = wishes.map(w => {
            const nickname = escapeHTML(w.nickname || 'åŒ¿å');
            const recipient = escapeHTML(w.recipient || 'å¤§å®¶');
            const content = escapeHTML(w.content || 'æ–°å¹´å¿«ä¹');
            return `<div class="wish-item"><span>${nickname}</span> ç¥ç¦ <span>${recipient}</span> Â· ${content}</div>`;
        }).join('');
        wishScroll.innerHTML = html + html;
    }
    
    function escapeHTML(str) {
        return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;');
    }
    
    window.submitWish = async function() {
        const nickname = document.getElementById('nickname')?.value.trim();
        const recipient = document.getElementById('recipient')?.value;
        const content = document.getElementById('wishContent')?.value.trim();
        if (!nickname || !content) { alert('è¯·å¡«å†™æ˜µç§°å’Œç¥ç¦å†…å®¹ï½'); return; }
        if (nickname.length > 20) { alert('æ˜µç§°ä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦'); return; }
        if (content.length > 50) { alert('ç¥ç¦å†…å®¹ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦'); return; }
        
        try {
            const btn = document.querySelector('.submit-btn');
            const originalText = btn.textContent;
            btn.textContent = 'âœ¨ æäº¤ä¸­... âœ¨';
            btn.disabled = true;
            await WishAPI.saveWish(nickname, recipient, content);
            await renderWishes();
            document.getElementById('nickname').value = '';
            document.getElementById('wishContent').value = '';
            closeWishModal();
            if (typeof launchFireworks === 'function') launchFireworks();
            btn.textContent = originalText;
            btn.disabled = false;
            alert('âœ… ç¥ç¦å·²å‘é€ï¼æ‰€æœ‰äººå¯è§ï½');
        } catch (error) {
            console.error('ä¿å­˜å¤±è´¥:', error);
            alert('âŒ ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
            const btn = document.querySelector('.submit-btn');
            if (btn) { btn.textContent = 'âœ¨ æäº¤ç¥ç¦ âœ¨'; btn.disabled = false; }
        }
    };
    
    window.openWishModal = function() {
        document.getElementById('wishModal').style.display = 'flex';
    };
    
    window.closeWishModal = function() {
        document.getElementById('wishModal').style.display = 'none';
    };
    
    window.onclick = function(event) {
        const modal = document.getElementById('wishModal');
        if (event.target === modal) closeWishModal();
    };
    
    // ===== ğŸŒ™ æ·±è‰²æ¨¡å¼ =====
    (function darkModeOnly() {
        document.body.style.backgroundColor = '#1a1a1a';
        window.addEventListener('load', function() {
            document.body.style.backgroundColor = '#1a1a1a';
        });
    })();
    
    // ===== ğŸ† çƒŸèŠ±ç‰¹æ•ˆ + ç»Ÿä¸€éŸ³æ•ˆä¿®å¤ï¼ˆå½»åº•æ¶ˆé™¤å›éŸ³ï¼‰=====
    (function fireworkInit() {
        const canvas = document.getElementById('fireworkCanvas');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        let particles = [];
        let animationFrame = null;
        let fireworkCounter = 0;
        let autoPlayTimer = null;
        
        // éŸ³é¢‘ç›¸å…³å˜é‡
        let audioCtx = null;
        let isMuted = false;
        let audioInitialized = false;
        
        // ===== ğŸ”‡ é˜²é‡å¤æ’­æ”¾é”ï¼ˆå½»åº•æ¶ˆé™¤å›éŸ³ï¼‰=====
        let lastPlayTime = 0;
        const MIN_PLAY_INTERVAL = 300; // 300mså†…ä¸é‡å¤æ’­æ”¾éŸ³æ•ˆ
        
        // æ˜¾ç¤ºéŸ³é¢‘æ¿€æ´»æç¤º
        function showAudioHint(message) {
            const oldHint = document.querySelector('.audio-hint');
            if (oldHint) oldHint.remove();
            
            const hint = document.createElement('div');
            hint.className = 'audio-hint';
            hint.textContent = message || 'ğŸ”Š ç‚¹å‡»é­ç‚®æ¿€æ´»éŸ³æ•ˆ';
            document.body.appendChild(hint);
            
            setTimeout(() => {
                if (hint.parentNode) hint.parentNode.removeChild(hint);
            }, 3000);
        }
        
        // åˆå§‹åŒ–éŸ³é¢‘
        function initAudio() {
            if (audioCtx || isMuted) return;
            
            try {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                console.log('AudioContext åˆ›å»ºï¼ŒçŠ¶æ€:', audioCtx.state);
                audioInitialized = true;
            } catch(e) {
                console.error('éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:', e);
            }
        }
        
        // æ¢å¤éŸ³é¢‘ä¸Šä¸‹æ–‡
        function resumeAudio() {
            if (!audioCtx) {
                initAudio();
                return false;
            }
            
            if (audioCtx.state === 'suspended') {
                audioCtx.resume().then(() => {
                    console.log('éŸ³é¢‘æ¢å¤æˆåŠŸ');
                    showAudioHint('ğŸ”Š éŸ³æ•ˆå·²æ¿€æ´»ï¼');
                }).catch(e => console.error('éŸ³é¢‘æ¢å¤å¤±è´¥:', e));
                return false;
            }
            
            return audioCtx.state === 'running';
        }
        
        // ===== ğŸ† ä¼˜åŒ–åçš„å•å±‚çƒŸèŠ±éŸ³æ•ˆï¼ˆæ¶ˆé™¤å›éŸ³æ„Ÿï¼‰=====
        function playFireworkSound() {
            const now = Date.now();
            // é˜²é‡å¤æ’­æ”¾ï¼š300mså†…ä¸é‡å¤æ’­æ”¾éŸ³æ•ˆ
            if (now - lastPlayTime < MIN_PLAY_INTERVAL) {
                console.log('éŸ³æ•ˆé˜²é‡è§¦å‘ï¼Œè·³è¿‡æ’­æ”¾');
                return;
            }
            lastPlayTime = now;
            
            if (isMuted || !audioCtx || audioCtx.state !== 'running') return;
            
            try {
                // å•ä¸ªæŒ¯è¡å™¨ï¼Œé¿å…åŒé‡çˆ†ç‚¸æ„Ÿ
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                oscillator.type = 'sine';
                oscillator.frequency.value = 160; // å•ä¸€é¢‘ç‡ï¼Œæ›´æ¸…è„†
                
                gainNode.gain.value = 0.16;
                gainNode.gain.linearRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
                
                console.log('æ’­æ”¾ä¼˜åŒ–çƒŸèŠ±éŸ³æ•ˆ');
            } catch(e) {
                console.error('æ’­æ”¾çƒŸèŠ±éŸ³æ•ˆå¤±è´¥:', e);
            }
        }
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        class FireworkParticle {
            constructor(x, y, color, isBig = false) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * (isBig ? 16 : 12);
                this.vy = (Math.random() - 0.8) * (isBig ? 16 : 12) - 3;
                this.size = isBig ? Math.random() * 5 + 4 : Math.random() * 3 + 2;
                this.color = color || `hsl(${Math.random() * 360}, 100%, 70%)`;
                this.alpha = 1;
                this.life = isBig ? Math.random() * 80 + 60 : Math.random() * 60 + 50;
                this.decay = 0.01 + Math.random() * 0.02;
                this.gravity = 0.1;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += this.gravity;
                this.alpha -= this.decay;
                this.life -= 1;
            }
            draw() {
                ctx.globalAlpha = Math.max(this.alpha, 0);
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.globalAlpha = 1;
            }
        }
        
        function createFirework(x, y, isBig = false, playSound = true) {
            const count = isBig ? 100 + Math.floor(Math.random() * 60) : 60 + Math.floor(Math.random() * 40);
            const baseColor = `hsl(${Math.random() * 360}, 90%, 65%)`;
            for (let i = 0; i < count; i++) {
                const colorVariant = `hsl(${Math.random() * 60 + (parseInt(baseColor.split(',')[0].split('(')[1]) || 0)}, 95%, 70%)`;
                particles.push(new FireworkParticle(x, y, colorVariant, isBig));
            }
            for (let i = 0; i < (isBig ? 30 : 15); i++) {
                particles.push(new FireworkParticle(x, y, `hsl(${Math.random() * 20 + 45}, 100%, 65%)`, isBig));
            }
            
            // æ’­æ”¾éŸ³æ•ˆï¼ˆå—é˜²é‡å¤é”æ§åˆ¶ï¼‰
            if (playSound && !isMuted) {
                playFireworkSound();
            }
        }
        
        // ===== ğŸ§¨ é­ç‚®è§†è§‰ç²’å­æ•ˆæœï¼ˆä¸åŒ…å«ä»»ä½•éŸ³æ•ˆï¼‰=====
        function createFirecrackerExplosion(x, y) {
            // çº¯è§†è§‰ç²’å­ï¼Œä¸è°ƒç”¨ä»»ä½•éŸ³æ•ˆå‡½æ•°
            for (let i = 0; i < 40; i++) {
                const particle = document.createElement('div');
                particle.className = 'cracker-particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.backgroundColor = `hsl(${Math.random() * 60 + 45}, 100%, 60%)`;
                particle.style.boxShadow = `0 0 15px hsl(${Math.random() * 60 + 45}, 100%, 60%)`;
                particle.style.transform = `translate(${(Math.random() - 0.5) * 300}px, ${(Math.random() - 0.5) * 300}px)`;
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1000);
            }
        }
        
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.update();
                if (p.alpha <= 0.02 || p.life <= 0 || p.y > canvas.height + 50 || p.x < -50 || p.x > canvas.width + 50) {
                    particles.splice(i, 1);
                    continue;
                }
                p.draw();
            }
            if (particles.length > 0 || fireworkCounter > 0) {
                animationFrame = requestAnimationFrame(animate);
            } else {
                animationFrame = null;
            }
        }
        
        window.launchFireworks = function(e) {
            if (!audioCtx) initAudio();
            
            let x, y;
            if (e && e.target && e.target.closest) {
                const star = e.target.closest('i');
                if (star) {
                    const rect = star.getBoundingClientRect();
                    x = rect.left + rect.width / 2;
                    y = rect.top + rect.height / 2;
                }
            }
            if (!x) {
                x = window.innerWidth * (0.3 + Math.random() * 0.4);
                y = window.innerHeight * (0.3 + Math.random() * 0.3);
            }
            
            const bursts = 2 + Math.floor(Math.random() * 2);
            for (let i = 0; i < bursts; i++) {
                setTimeout(() => {
                    createFirework(x + (Math.random()-0.5)*40, y + (Math.random()-0.5)*30, true, true);
                }, i * 100);
            }
            fireworkCounter++;
            if (!animationFrame) animate();
            setTimeout(() => fireworkCounter--, 500);
        };
        
        // è‡ªåŠ¨æ’­æ”¾ - ä¸è§¦å‘éŸ³æ•ˆ
        function startAutoPlay() {
            let count = 0;
            autoPlayTimer = setInterval(() => {
                const x = window.innerWidth * (0.2 + Math.random() * 0.6);
                const y = window.innerHeight * (0.2 + Math.random() * 0.4);
                createFirework(x, y, true, false);
                fireworkCounter++;
                if (!animationFrame) animate();
                setTimeout(() => fireworkCounter--, 500);
                
                count++;
                if (count >= 8) {
                    clearInterval(autoPlayTimer);
                    setTimeout(() => startAutoPlay(), 15000);
                }
            }, 1000);
        }
        
        // æ˜Ÿæ˜Ÿç‚¹å‡»äº‹ä»¶ - æ’­æ”¾çƒŸèŠ±éŸ³æ•ˆ
        document.querySelectorAll('.lantern-stars i').forEach(star => {
            star.addEventListener('click', function(e) {
                e.stopPropagation();
                if (!audioCtx) initAudio();
                else resumeAudio();
                window.launchFireworks(e);
            });
        });
        
        // ===== ğŸ† é­ç‚®ç‚¹å‡»äº‹ä»¶ - éŸ³æ•ˆå®Œå…¨ä¸ç¹æ˜Ÿä¸€è‡´ï¼Œå½»åº•æ¶ˆé™¤å›éŸ³ =====
        const firecracker = document.getElementById('firecracker');
        if (firecracker) {
            firecracker.addEventListener('click', function(e) {
                e.stopPropagation();
                
                if (!audioCtx) {
                    initAudio();
                    showAudioHint('ğŸ”Š æ­£åœ¨æ¿€æ´»éŸ³æ•ˆ...');
                    
                    setTimeout(() => {
                        if (audioCtx && audioCtx.state === 'suspended') {
                            audioCtx.resume().then(() => {
                                console.log('é­ç‚®ç‚¹å‡»æ¢å¤éŸ³é¢‘æˆåŠŸ');
                                showAudioHint('ğŸ”Š éŸ³æ•ˆå·²æ¿€æ´»ï¼');
                            }).catch(e => console.error('é­ç‚®ç‚¹å‡»æ¢å¤éŸ³é¢‘å¤±è´¥:', e));
                        }
                    }, 100);
                } else {
                    resumeAudio();
                }
                
                const rect = this.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                
                // 1. é­ç‚®è§†è§‰ç²’å­ï¼ˆçº¯è§†è§‰ï¼Œæ— éŸ³æ•ˆï¼‰
                createFirecrackerExplosion(x, y);
                
                // 2. ç”ŸæˆçƒŸèŠ±ç²’å­ï¼Œä½†ä¸æ’­æ”¾éŸ³æ•ˆï¼ˆé¿å…é‡å¤ï¼‰
                createFirework(x, y, true, false);  // playSound = falseï¼Œä¸è§¦å‘éŸ³æ•ˆ
                
                // 3. å•ç‹¬æ’­æ”¾ä¸€æ¬¡çƒŸèŠ±éŸ³æ•ˆï¼ˆå—é˜²é‡å¤é”æ§åˆ¶ï¼Œ300mså†…åªä¼šæ’­æ”¾ä¸€æ¬¡ï¼‰
                if (!isMuted && audioCtx && audioCtx.state === 'running') {
                    playFireworkSound();  // åªæ’­æ”¾éŸ³æ•ˆï¼Œä¸ç”Ÿæˆé¢å¤–çƒŸèŠ±
                }
                
                this.style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => this.style.animation = 'swing 2s ease-in-out infinite', 500);
            });
        }
        
        // é™éŸ³æŒ‰é’®
        const muteBtn = document.getElementById('muteBtn');
        if (muteBtn) {
            muteBtn.addEventListener('click', function() {
                isMuted = !isMuted;
                this.textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
                this.style.opacity = isMuted ? '0.7' : '1';
                
                if (audioCtx) {
                    if (isMuted) {
                        audioCtx.suspend().catch(e => console.error('æš‚åœéŸ³é¢‘å¤±è´¥:', e));
                    } else {
                        audioCtx.resume().catch(e => console.error('æ¢å¤éŸ³é¢‘å¤±è´¥:', e));
                    }
                }
            });
        }
        
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (!audioCtx && !isMuted) {
                    try {
                        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                        audioInitialized = true;
                        console.log('éŸ³é¢‘é¢„åˆå§‹åŒ–å®Œæˆï¼ŒçŠ¶æ€:', audioCtx.state);
                    } catch(e) {
                        console.error('éŸ³é¢‘é¢„åˆå§‹åŒ–å¤±è´¥:', e);
                    }
                }
            }, 1000);
            
            setTimeout(() => {
                startAutoPlay();
            }, 1000);
        });
        
    })();
    
    // ===== ğŸ é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–ç¥ç¦å¢™ =====
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('wishScroll')) renderWishes();
        });
    } else {
        if (document.getElementById('wishScroll')) renderWishes();
    }
    </script>
</body>
</html>